<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8"></meta>
		<title> Elastic Collision </title>
		<script type="text/javascript" src="Ball.js"></script>
		
		<script type="text/javascript">
			var width = 0, height = 0;
			var context;

			var balls = [];
			var initMousePressX = 0, initMousePressY = 0;
			var finalMousePressX = 0, finalMousePressY = 0;
			
			function getRndInteger(min, max) {
				return Math.floor(Math.random() * (max - min + 1) ) + min;
			}			
			
			function update(){
				// clear the screen 
				context.clearRect(0, 0, width, height);
				
				for (let b1 = 0; b1 < balls.length; b1++) {
					balls[b1].move();
					for (let b2 = 0; b2 < balls.length; b2++) {
						if (b2 != b1 && balls[b1].isCollided(balls[b2])) {
							balls[b1].setVelocityAfterCollision(balls[b2]);
						}
					}
					context.fillStyle = "#003E3E";
					context.beginPath();
					context.arc(balls[b1].position.x, balls[b1].position.y, balls[b1].radius, 0, 2*Math.PI);
					
					context.fill();
				}
				
			}
			
			function onChangeRangeRadius(e) {
				document.getElementById("labelRadius").innerHTML = document.getElementById("rangeRadius").value;
			}
			
			function onChangeRangeMass(e) {
				document.getElementById("labelMass").innerHTML = document.getElementById("rangeMass").value;
			}
			
			function clearBalls() {
				balls=[];
			}
			
			window.addEventListener("load", function (event) {
				var canvas = document.getElementById("canvas");
				document.getElementById("labelRadius").innerHTML = document.getElementById("rangeRadius").value;
				document.getElementById("labelMass").innerHTML = document.getElementById("rangeMass").value;
				
				
				context = canvas.getContext("2d");

				width = window.innerWidth - 400;
				height = window.innerHeight- 100;
			
				canvas.style.width = width + 'px';
				canvas.style.height = height + 'px';
				canvas.width = width;
				canvas.height = height;

				worldWidth = width; // =context.canvas.width;
				worldHeight = height; // =context.canvas.height;
				
				canvas.addEventListener('mousedown', function(event){
					initMousePressX = event.pageX-this.offsetLeft-10;
					initMousePressY = event.pageY-this.offsetTop-10;
					console.log("mousedown");
				});
				
				canvas.addEventListener('mouseup', function(event){
					finalMousePressX = event.pageX-this.offsetLeft-10;
					finalMousePressY = event.pageY-this.offsetTop-10;
					var mass = parseInt(document.getElementById("rangeMass").value);
					var radius = parseInt(document.getElementById("rangeRadius").value);
					var position = new Pair(initMousePressX, initMousePressY);
					var velocity = new Pair((finalMousePressX-initMousePressX)/40, (finalMousePressY-initMousePressY)/40);
					let ball = new Ball(position, velocity, radius, mass);
					balls.push(ball);
					console.log("mouseup");
				});

				// create the world (50 balls)
				for(let i = 0; i < 5; i++) { 
					let rndPosX = getRndInteger(100, worldWidth);
					let rndPosY = getRndInteger(100, worldHeight);
					let rndVelX = getRndInteger(1, 3) * (Math.round(Math.random()) * 2 - 1);
					let rndVelY = getRndInteger(1, 3) * (Math.round(Math.random()) * 2 - 1);
					let rndRadius = getRndInteger(10, 40);
					var b = new Ball(new Pair(rndPosX, rndPosY), new Pair(rndVelX, rndVelY), rndRadius, 10);
					balls.push(b);
				}
				
				// let the world run
				setInterval(update, 10);
			});
			
			
			
		</script>
	</head>
	
	<body>
		<table>
			<tr>
				<td>
					<canvas id="canvas" width="300" height="300" style="border:1px solid #000000;"></canvas>
				</td>
				<td>
					<form>
						<table>
							<tr>
								<td>
									Radius:
								</td>
								<td>
									<input type="range" id="rangeRadius" name="rangeRadius" min="10" max="50" onchange="onChangeRangeRadius()"></input>
								</td>
								<td>
									<div id="labelRadius"></div> <br>
								</td>
							</tr>
							<tr>
								<td>
									Mass:
								</td>
								<td>
									<input type="range" id="rangeMass" name="rangeMass" min="10" max="50" onchange="onChangeRangeMass()"></input> 
								</td>
								<td>
									<div id="labelMass"></div> <br>
								</td>
							</tr>
							<tr>
								<td>
									<input type="button" id="buttonClear" name="buttonClear" onclick="clearBalls()" value="Clear"></input>
								</td>
							</tr>
						</table>
					</form>
				</td>
			</tr>
		</table>
	</body>
</html>